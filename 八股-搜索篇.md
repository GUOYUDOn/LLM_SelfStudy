### 1. 讲一下 HNSW

在使用 Elasticsearch + 向量检索的场景中，最常用、最核心的底层算法之一就是 HNSW（Hierarchical Navigable Small World），它是目前速度快、精度高、效率好的近似最近邻（ANN）检索算法之一。

HNSW（分层可导航小世界图结构），其核心思想是核心思想是：构建一个带有分层结构的图，其中每个向量是图的一个节点，节点之间有边表示它们彼此相似。检索时，从图的高层“粗搜索”，然后在低层“精搜索”。

**结构**：

1. 分层结构（Hierarchical）：每个向量被随机分配一个层数（level），层数越高的点越稀疏；最顶层有最少的点（粗粒度导航），最底层有所有点（细粒度搜索）。

2. 小世界图（Navigable Small World）：每个点与其附近的若干个向量建立边（连接）；邻居节点之间可以快速跳转，形成“小世界特性”：高聚类性+短平均路径长度。

**搜索流程**：给定一个查询向量 $q$，从最高层起始点出发，在该层中通过贪心策略移动到距离 $q$ 最近的邻居，不断移动直到局部最优（无法再接近）；向下一层继续重复此过程（以上层结果为入口）；到达最底层时，再用一个小堆进行精细搜索，得到 Top-K 近似最近邻。